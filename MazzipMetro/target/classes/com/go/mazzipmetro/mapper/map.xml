<<<<<<< HEAD
<?xml version="1.0" encoding="UTF-8"?>
<!-- #11. mapper 기본 설정 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<!-- #12. 루트 엘리먼트 및 네임스페이스 설정하기(이 네임스페이스의 이름은 프로젝트 전체 내에서 반드시 고유해야만 한다.) --> 
<mapper namespace="map">

	<insert id="insertMetro" parameterType="java.util.HashMap">
		insert into tbl_metro(metroId, metroName, metroNum, latitude, longitude)
		values(#{metroNum}||lpad(seq_tbl_metro.nextval,3,'0'),#{metroName},#{metroNum}, #{latitude},#{longitude})
	</insert>
	
	<insert id="insertRestaurant" parameterType="java.util.HashMap">
		insert into tbl_restaurant(restSeq, userSeq, restName, restAddr, restNewAddr, restPhone, restLatitude, restLongitude, restZIndex, metroId, dongId)
		values(seq_tbl_restaurant.nextval, 0, #{restaurantTitle},#{addr},#{newAddr},#{phone},#{latitude},#{longitude},seq_tbl_restaurant.currval,#{metroId},#{dongId})    
	</insert>
	
	<select id="dongId"  parameterType="String" resultType="String" >
		select dongId
		from tbl_dong
		where dongName = #{dongName}
	</select>
	
	<select id="metroId"  parameterType="String" resultType="String" >
		select metroId
		from tbl_metro
		where metroName = #{metroName}
	</select>
	
	<resultMap type="java.util.HashMap" id="restaurantList">
		<result column="restName" 	property="restName" 	javaType="String"/><!-- vo의 멤버변수명이다. 여기는 xml -->
		<result column="restSeq" 		property="restSeq" 		javaType="String"/> 
		<result column="longitude" 		property="lng" 	javaType="String"/>
		<result column="latitude" 		property="lat" 		javaType="String" />  
	</resultMap>
	<select id="getRestaurantList"  resultMap="restaurantList">
		select restName, restSeq, latitude, longitude
		from tbl_restaurant
	</select>
	
	<!-- 지하철역별 등록된 음식점 보여주기 -->
	<select id="searchByMetro" parameterType="java.util.HashMap" resultType="com.go.mazzipmetro.vo.RestaurantVO">
		select V.*
		from (
		select row_number () over(order by restVisitor desc) AS rnum
		     , A.*
		from tbl_restaurant A 
		where  A.restStatus = 0
		<if test="keyword != null">
		and metroId = (select metroId from tbl_metro where metroName like '%'||#{keyword}||'%')
		</if>
		) V
		where rnum between #{start} and #{end}
	</select>
	
	<!-- 지하철역별 등록된 음식점 보여주기(bgCat얻어오기) -->
	<select id="getRestBgTag" parameterType="String" resultType="String">
		select tagName
		from tbl_restaurant_tag
		where tagStatus = 0 and restSeq = #{restSeq} and tagSort='bgCat'
	</select>
	
	<!-- 지하철역별 등록된 음식점 보여주기(mdCat얻어오기) -->
	<select id="getRestMdTag" parameterType="String" resultType="String">
		select tagName
		from tbl_restaurant_tag
		where tagStatus = 0 and restSeq = #{restSeq} and tagSort='mdCat'
	</select>
	
	
	<!-- 지하철역별 등록된 음식점 보여주기(총 음시점 수 구하기) -->
	<select id="getTotalCount" parameterType="java.util.HashMap" resultType="int">
		select count(*)
		from tbl_restaurant
		where restStatus = 0
		<if test="keyword != null">
			and metroId = (select metroId from tbl_metro where metroName like '%'||#{keyword}||'%')
		</if>
	</select>
	
=======
<?xml version="1.0" encoding="UTF-8"?>
<!-- #11. mapper 기본 설정 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<!-- #12. 루트 엘리먼트 및 네임스페이스 설정하기(이 네임스페이스의 이름은 프로젝트 전체 내에서 반드시 고유해야만 한다.) --> 
<mapper namespace="map">

	<insert id="insertMetro" parameterType="java.util.HashMap">
		insert into tbl_metro(metroId, metroName, metroNum, latitude, longitude)
		values(#{metroNum}||lpad(seq_tbl_metro.nextval,3,'0'),#{metroName},#{metroNum}, #{latitude},#{longitude})
	</insert>
	
	<insert id="insertRestaurant" parameterType="java.util.HashMap">
		insert into tbl_restaurant(restSeq,restName,addr,newAddr,phone,latitude,longitude,z_index,metroId,dongId)
		values(seq_tbl_restaurant.nextval,#{restaurantTitle},#{addr},#{newAddr},#{phone},#{latitude},#{longitude},seq_tbl_restaurant.currval,#{metroId},#{dongId})    
	</insert>
	
	<select id="dongId"  parameterType="String" resultType="String" >
		select dongId
		from tbl_dong
		where dongName = #{dongName}
	</select>
	
	<select id="metroId"  parameterType="String" resultType="String" >
		select metroId
		from tbl_metro
		where metroName = #{metroName}
	</select>
	
	<resultMap type="java.util.HashMap" id="restaurantList">
		<result column="restName" 	property="restName" 	javaType="String"/><!-- vo의 멤버변수명이다. 여기는 xml -->
		<result column="restSeq" 		property="restSeq" 		javaType="String"/> 
		<result column="longitude" 		property="lng" 	javaType="String"/>
		<result column="latitude" 		property="lat" 		javaType="String" />  
	</resultMap>
	<select id="getRestaurantList"  resultMap="restaurantList">
		select restName, restSeq, latitude, longitude
		from tbl_restaurant
	</select>
	
>>>>>>> e25d0fae82f737c75cdb45ee4d5e41d7003ee834
</mapper>