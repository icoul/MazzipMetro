<?xml version="1.0" encoding="UTF-8"?>
<!-- #11. mapper 기본 설정 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<!-- #12. 루트 엘리먼트 및 네임스페이스 설정하기(이 네임스페이스의 이름은 프로젝트 전체 내에서 반드시 고유해야만 한다.) --> 
<mapper namespace="restaurant">
	
	<!-- 업장이름 리스트 가져오기 -->
	<select id="restaurant.getRestName" parameterType="String" resultType="com.go.mazzipmetro.vo.RestaurantVO">
		select restSeq,  userSeq,  gradeSeq,  restName,  restPhone,
			   restImg,  restAddr,  restNewAddr,  restLatitude,  restLongitude,
			   restZIndex,  dongId,  metroId,  restRegDate,  restVisitor, restStatus
		from TBL_Restaurant
		where restName like '%' || #{name} || '%'
	</select>
	
	<!-- 사업주의  리스트 가져오기 -->
	<select id="getRestrauntList" parameterType="String" resultType="com.go.mazzipmetro.vo.RestaurantVO">
		select restSeq,  userSeq,  gradeSeq,  restName,  restPhone,
			   restImg,  restAddr,  restNewAddr,  restLatitude,  restLongitude,
			   restZIndex,  dongId,  metroId,  restRegDate,  restVisitor, restStatus
		from TBL_Restaurant
		where userseq = #{userseq} and restStatus = 0
	</select>
	
	<!-- 새 업장 등록 -->
	<insert id="restaurant.setRestRegister" parameterType="com.go.mazzipmetro.vo.RestaurantVO">
		insert into TBL_Restaurant values(TBL_Restaurant_Seq.nextval, #{userSeq}, default, #{restName}
										, #{restPhone}, 
										<if test="restImg == null or restImg.equals('')">
											default
										</if>
										<if test="restImg != null and !restImg.equals('')">
											#{restImg}
										</if>
										, #{restAddr}, #{restNewAddr}
										, #{restLatitude}, #{restLongitude}, TBL_Restaurant_Seq.nextval
										, #{dongId}, #{metroId}, default, 0, default)
	</insert>
	
	<!-- 기존 업장 업데이트 -->
	<update id="restaurant.setRestUpdate" parameterType="com.go.mazzipmetro.vo.RestaurantVO">
		update TBL_Restaurant set userSeq = #{userSeq}, restImg = 
										<if test="restImg == null or restImg.equals('')">
											default
										</if>
										<if test="restImg != null and !restImg.equals('')">
											#{restImg}
										</if>
										, restPhone = #{restPhone}, restRegDate = sysdate
		where restSeq = #{restSeq}
	</update>
	
	<!-- 업장을 새로 등록했기 때문에 Seq번호를 새로 가져오기 위함. -->
	<select id = "restaurant.getNewRestSeq" parameterType="String" resultType="String">
		select max(restSeq)
		from TBL_Restaurant
		where userseq = #{userSeq}
	</select>
	
	<!-- 업장 소개글 추가 -->
	<update id="restaurant.setRestContent" parameterType="java.util.HashMap">
		update TBL_Restaurant set restContent = #{restContent}
		where restSeq = #{restSeq}
	</update>
	
	<!-- 업장 이미지 추가 -->
	<insert id="restaurant.setRestImg" parameterType="java.util.HashMap">
		insert into TBL_Restaurant_Ad(restSeq, AdImg) values(#{restSeq}, #{AdImg})
	</insert>
	
	<!-- 업장 대태그 추가 -->
	<insert id="restaurant.setRestBgTag" parameterType="java.util.HashMap">
		insert into TBL_Restaurant_Tag(restSeq, tagSort, tagName, tagStatus) values(#{restSeq}, 'bgCat', #{bgCat}, default)
	</insert>
	
	<!-- 업장 중태그 추가 -->
	<insert id="restaurant.setRestMdTag" parameterType="java.util.HashMap">
		insert into TBL_Restaurant_Tag(restSeq, tagSort, tagName, tagStatus) values(#{restSeq}, 'mdCat', #{mdCat}, default)
	</insert>
	
	<!-- 메뉴 추가 -->
	<insert id="restaurant.setMenu" parameterType="java.util.HashMap">
		insert into TBL_Restaurant_Menu(restSeq, menuName, menuContent, menuImg, menuPrice, menuSalePrice, menuSort, menuEvent, menuStatus) 
		values(#{restSeq}, '${menuName}', #{menuContent}, 
			<if test="menuImg == null or menuImg.equals('')">
				default
			</if>
			<if test="menuImg != null and !menuImg.equals('')">
				#{menuImg}
			</if>
		, #{menuPrice}, #{menuSalePrice}, #{menuSort}, 
			<if test="menuEvent == null or menuEvent.equals('')">
				default
			</if>
			<if test="menuEvent != null and !menuEvent.equals('')">
				#{menuEvent}
			</if>
		, default)
	</insert>
	
</mapper>